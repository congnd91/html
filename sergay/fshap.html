<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Sergey Kostrukov" />

    <title>
        Sergey Kostrukov
    </title>

    <meta name="description" content="Sergey Kostrukov Blog">



    <!-- Fonts -->
    <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic'>
    <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'>
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans:400,400i,700,700i&amp;subset=cyrillic,cyrillic-ext,devanagari,greek,greek-ext,latin-ext,vietnamese" rel="stylesheet">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha256-NuCn4IvuZXdBaFKJOAcsU2Q3ZpwbdFisd5dux4jkQ5w=" crossorigin="anonymous" />

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous" />

    <link rel="stylesheet" href="assets/css/main.css">

</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
        <div class="container">
            <a class="navbar-brand" href="/">Sergey Kostrukov</a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>

            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">

                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="/posts">Posts</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="/about">About</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="/contact">Contact</a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>


    <!-- Page Header -->

    <header class="masthead" style="background-image: url('img/06.jpg')">

        <div class="overlay"></div>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-md-10 mx-auto">
                    <div class="post-heading">
                        <h1>Man must explore, and this is exploration at its greatest</h1>

                        <h2 class="subheading">Problems look mighty small from 150 miles up</h2>

                        <span class="meta">Posted by
            
              <a target="_blank" href="/about">Sergey Kostrukov</a>
            
            on October 31, 2017</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-10 mx-auto">

                <p><a href="https://kostr.se/e8042">Lorem</a> ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Libero nunc consequat interdum varius sit amet.</p>

                <p>Consequat mauris nunc congue nisi vitae. Laoreet non curabitur gravida arcu ac tortor dignissim. Consectetur adipiscing elit ut aliquam purus sit amet. Erat imperdiet sed euismod nisi porta lorem mollis aliquam.</p>

                <p>Facilisi nullam vehicula ipsum a arcu cursus vitae congue mauris. Id ornare arcu odio ut sem nulla pharetra <code class="highlighter-rouge">IServiceCollection</code> and <code class="highlighter-rouge">IServiceProvider</code>.</p>

                <h1 id="a-giraffe-application">A Giraffe application</h1>

                <p>Arcu dictum varius duis at consectetur lorem. Massa enim nec dui nunc mattis enim ut tellus. Potenti nullam ac tortor vitae purus faucibus ornare suspendisse sed. Integer vitae justo eget magna fermentum.</p>

                <p>Massa tincidunt nunc pulvinar sapien: <code class="highlighter-rouge">POST /order</code> et ligula ullamcorper.</p>

                <p>Tellus in hac habitasse platea. Lectus vestibulum mattis ullamcorper velit <code class="highlighter-rouge">productId</code> sed <code class="highlighter-rouge">quantity</code> ullamcorper morbi tincidunt. Adipiscing commodo elit at imperdiet dui accumsan. Eu non diam phasellus vestibulum.</p>

                <p>Pellentesque elit eget gravida cum sociis natoque penatibus et magnis.</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="k">open</span> <span class="nc">System</span>
<span class="k">open</span> <span class="nn">Microsoft</span><span class="p">.</span><span class="nn">AspNetCore</span><span class="p">.</span><span class="nc">Builder</span>
<span class="k">open</span> <span class="nn">Microsoft</span><span class="p">.</span><span class="nn">AspNetCore</span><span class="p">.</span><span class="nc">Hosting</span>
<span class="k">open</span> <span class="nn">Microsoft</span><span class="p">.</span><span class="nn">Extensions</span><span class="p">.</span><span class="nc">DependencyInjection</span>
<span class="k">open</span> <span class="nc">Giraffe</span>
<span class="k">open</span> <span class="nn">Microsoft</span><span class="p">.</span><span class="nn">AspNetCore</span><span class="p">.</span><span class="nc">Http</span>
<span class="k">open</span> <span class="nn">FSharp</span><span class="p">.</span><span class="nn">Control</span><span class="p">.</span><span class="nn">Tasks</span><span class="p">.</span><span class="nn">V2</span><span class="p">.</span><span class="nc">ContextInsensitive</span>

<span class="c1">// Order request received from customers</span>
<span class="p">[&lt;</span><span class="nc">CLIMutable</span><span class="p">&gt;]</span>
<span class="k">type</span> <span class="nc">OrderRequest</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nc">ProductId</span><span class="p">:</span> <span class="kt">int</span>
    <span class="nc">Quantity</span><span class="p">:</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="c1">// Order confirmation with order number, returned back to customers</span>
<span class="k">type</span> <span class="nc">OrderConfirmation</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nc">OrderNumber</span><span class="p">:</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// Our application logic here: handling customer order</span>
<span class="k">let</span> <span class="n">handleOrder</span> <span class="p">(</span><span class="n">order</span><span class="p">:</span> <span class="nc">OrderRequest</span><span class="p">)</span> <span class="p">:</span> <span class="nc">HttpHandler</span> <span class="p">=</span>
    <span class="k">fun</span> <span class="p">(</span><span class="n">next</span> <span class="p">:</span> <span class="nc">HttpFunc</span><span class="p">)</span> <span class="p">(</span><span class="n">ctx</span> <span class="p">:</span> <span class="nc">HttpContext</span><span class="p">)</span> <span class="p">-&gt;</span>
        <span class="n">task</span> <span class="p">{</span>
            <span class="c1">// TODO: Generate order number</span>
            <span class="k">let</span> <span class="n">orderNumber</span> <span class="p">=</span> <span class="s2">"???"</span>

            <span class="c1">// Send back order confirmation with order number</span>
            <span class="k">let</span> <span class="n">orderConfirmation</span> <span class="p">=</span> <span class="p">{</span> <span class="nc">OrderNumber</span> <span class="p">=</span> <span class="n">orderNumber</span> <span class="p">}</span>
            <span class="k">return</span><span class="o">!</span> <span class="n">json</span> <span class="n">orderConfirmation</span> <span class="n">next</span> <span class="n">ctx</span>
        <span class="p">}</span>

<span class="k">let</span> <span class="n">routes</span> <span class="p">=</span>
    <span class="c1">// REST API method which accepts orders from customers</span>
    <span class="n">route</span> <span class="s2">"/order"</span> <span class="o">&gt;=&gt;</span> <span class="nc">POST</span> <span class="o">&gt;=&gt;</span> <span class="n">bindForm</span><span class="p">&lt;</span><span class="nc">OrderRequest</span><span class="p">&gt;</span> <span class="nc">None</span> <span class="n">handleOrder</span>

<span class="k">let</span> <span class="n">configureApp</span> <span class="p">(</span><span class="n">app</span> <span class="p">:</span> <span class="nc">IApplicationBuilder</span><span class="p">)</span> <span class="p">=</span>
    <span class="n">app</span><span class="p">.</span><span class="nc">UseGiraffe</span> <span class="n">routes</span>

<span class="k">let</span> <span class="n">configureServices</span> <span class="p">(</span><span class="n">services</span> <span class="p">:</span> <span class="nc">IServiceCollection</span><span class="p">)</span> <span class="p">=</span>
		<span class="c1">// Registration of services to DI container</span>
    <span class="n">services</span><span class="p">.</span><span class="nc">AddGiraffe</span><span class="bp">()</span> <span class="p">|&gt;</span> <span class="n">ignore</span>

<span class="p">[&lt;</span><span class="nc">EntryPoint</span><span class="p">&gt;]</span>
<span class="k">let</span> <span class="n">main</span> <span class="p">_</span> <span class="p">=</span>
    <span class="k">let</span> <span class="n">config</span> <span class="p">=</span>
        <span class="nc">ConfigurationBuilder</span><span class="bp">()</span>
            <span class="p">.</span><span class="nc">AddJsonFile</span><span class="p">(</span><span class="s2">"appsettings.json"</span><span class="p">)</span>
            <span class="p">.</span><span class="nc">Build</span><span class="bp">()</span>

    <span class="nc">WebHostBuilder</span><span class="bp">()</span>
        <span class="p">.</span><span class="nc">UseConfiguration</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="p">.</span><span class="nc">UseKestrel</span><span class="bp">()</span>
        <span class="p">.</span><span class="nc">Configure</span><span class="p">(</span><span class="nc">Action</span><span class="p">&lt;</span><span class="nc">IApplicationBuilder</span><span class="p">&gt;</span> <span class="n">configureApp</span><span class="p">)</span>
        <span class="p">.</span><span class="nc">ConfigureServices</span><span class="p">(</span><span class="n">configureServices</span><span class="p">)</span>
        <span class="p">.</span><span class="nc">Build</span><span class="bp">()</span>
        <span class="p">.</span><span class="nc">Run</span><span class="bp">()</span>
    <span class="mi">0</span>
</code></pre>
                    </div>
                </div>

                <p>Nunc scelerisque viverra mauris in aliquam <em>appsettings.json</em> sem fringilla ut morbi. Odio ut enim blandit volutpat maecenas. Dolor morbi non arcu risus quis varius.</p>

                <div class="language-json highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"Orders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"StartOrderNumber"</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
                    </div>
                </div>

                <p>Ornare aenean euismod elementum nisi. Risus in hendrerit gravida rutrum quisque non tellus.</p>

                <h1 id="functional-business-logic">Functional business logic</h1>

                <p>Scelerisque eu ultrices vitae auctor eu augue. Arcu ac tortor dignissim convallis aenean et tortor at risus. Venenatis cras sed felis eget velit aliquet sagittis. Aliquam nulla facilisi cras fermentum odio. Pharetra vel turpis nunc eget lorem dolor.</p>

                <p>Feugiat vivamus at augue eget arcu dictum varius.</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="c1">// Product, represented by the product ID</span>
<span class="k">type</span> <span class="nc">Product</span> <span class="p">=</span> <span class="nc">ProductId</span> <span class="k">of</span> <span class="kt">int</span>

<span class="c1">// Quantity. represented by amount in pieces</span>
<span class="k">type</span> <span class="nc">Quantity</span> <span class="p">=</span> <span class="nc">Pcs</span> <span class="k">of</span> <span class="kt">int</span>

<span class="c1">// ProductNumber, composed of prefix string and the number itself</span>
<span class="k">type</span> <span class="nc">OrderNumber</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nc">Prefix</span><span class="p">:</span> <span class="kt">string</span>
    <span class="nc">Number</span><span class="p">:</span> <span class="kt">int</span>
<span class="p">}</span> <span class="k">with</span>
    <span class="k">override</span> <span class="n">this</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span> <span class="p">=</span> <span class="n">sprintf</span> <span class="s2">"%s-%d"</span> <span class="n">this</span><span class="p">.</span><span class="nc">Prefix</span> <span class="n">this</span><span class="p">.</span><span class="nc">Number</span>
</code></pre>
                    </div>
                </div>

                <p>Sed ullamcorper morbi tincidunt ornare massa eget egestas purus viverra: <strong>Product</strong>, <strong>Quantity</strong> and <strong>OrderNumber</strong>.</p>

                <p>Odio aenean sed adipiscing diam donec adipiscing tristique. Nec feugiat nisl <a href="https://fsharpforfunandprofit.com/series/designing-with-types.html">“Designing with types” series</a> ut tortor pretium. Dolor magna eget est lorem <a href="https://vimeo.com/223983252">Domain Modeling Made Functional</a>.</p>

                <p>Sit amet consectetur adipiscing elit duis tristique sollicitudin. Sem fringilla ut morbi tincidunt augue. Enim sed faucibus turpis in. Non diam phasellus vestibulum lorem sed risus ultricies tristique nulla. Pulvinar neque laoreet suspendisse interdum consectetur libero.</p>

                <p>Et netus et malesuada fames ac turpis egestas sed tempus:</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="nc">Product</span> <span class="p">-&gt;</span> <span class="nc">OrderNumber</span>
</code></pre>
                    </div>
                </div>

                <p>Tristique senectus et netus et malesuada. Mi proin sed libero enim sed faucibus turpis in. Volutpat sed cras ornare arcu dui.</p>

                <p>Tortor at <em>Product</em> auctor urna nunc id <em>OrderNumber</em> cursus metus aliquam eleifend. Et malesuada fames ac turpis egestas integer eget. Volutpat consequat mauris nunc congue. Mattis enim ut tellus elementum sagittis vitae et leo duis.</p>

                <p>Porttitor rhoncus dolor purus non enim:</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="k">module</span> <span class="nc">OrderNumbering</span> <span class="p">=</span>
    <span class="c1">// Thread-safe number counter which keeps the state of number generator functon</span>
    <span class="k">type</span> <span class="k">private</span> <span class="nc">Counter</span> <span class="p">(</span><span class="n">startVal</span><span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">=</span>
        <span class="k">let</span> <span class="k">mutable</span> <span class="n">currVal</span><span class="p">:</span> <span class="kt">int</span> <span class="p">=</span> <span class="n">startVal</span>
        <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nc">Next</span> <span class="bp">()</span><span class="p">:</span> <span class="kt">int</span> <span class="p">=</span> <span class="nn">Interlocked</span><span class="p">.</span><span class="nc">Increment</span> <span class="p">&amp;</span><span class="n">currVal</span>

    <span class="c1">// Generates a new order number with provided prefix</span>
    <span class="k">let</span> <span class="n">generate</span> <span class="p">(</span><span class="n">counter</span><span class="p">:</span> <span class="nc">Counter</span><span class="p">)</span> <span class="p">(</span><span class="n">product</span><span class="p">:</span> <span class="nc">Product</span><span class="o">):</span> <span class="nc">OrderNumber</span> <span class="p">=</span>
        <span class="k">let</span> <span class="p">(</span><span class="nc">ProductId</span> <span class="n">productId</span><span class="p">)</span> <span class="p">=</span> <span class="n">product</span>
        <span class="k">let</span> <span class="n">prefix</span> <span class="p">=</span> <span class="n">sprintf</span> <span class="s2">"INV%d"</span> <span class="n">productId</span>
        <span class="k">let</span> <span class="n">number</span> <span class="p">=</span> <span class="n">counter</span><span class="p">.</span><span class="nc">Next</span> <span class="bp">()</span>
        <span class="p">{</span> <span class="nc">Prefix</span> <span class="p">=</span> <span class="n">prefix</span><span class="p">;</span> <span class="nc">Number</span> <span class="p">=</span> <span class="n">number</span> <span class="p">}</span>
</code></pre>
                    </div>
                </div>

                <h1 id="registering-functions">Registering functions</h1>

                <p>Proin sagittis nisl rhoncus mattis. In aliquam sem fringilla ut morbi tincidunt augue interdum. Enim diam vulputate ut pharetra sit amet aliquam id diam.</p>

                <p><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-2.2">Dependency injection in ASP.NET Core</a></p>

                <p>At ultrices mi tempus imperdiet nulla. Scelerisque eleifend donec pretium vulputate sapien nec sagittis aliquam malesuada <em>functions</em>:</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="k">let</span> <span class="n">configureServices</span> <span class="p">(</span><span class="n">services</span> <span class="p">:</span> <span class="nc">IServiceCollection</span><span class="p">)</span> <span class="p">=</span>
    <span class="c1">// Registration of services to DI container</span>
    <span class="n">services</span><span class="p">.</span><span class="nc">AddSingleton</span><span class="p">&lt;</span><span class="nc">Product</span> <span class="p">-&gt;</span> <span class="nc">OrderNumber</span><span class="o">&gt;(???)</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
    <span class="n">services</span><span class="p">.</span><span class="nc">AddGiraffe</span><span class="bp">()</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
</code></pre>
                    </div>
                </div>

                <p>Amet nisl purus in mollis nunc sed. Gravida quis blandit turpis cursus in hac habitasse platea. Gravida neque convallis a cras semper auctor.</p>

                <p>Phasellus egestas tellus rutrum tellus pellentesque. Elementum eu facilisis sed odio morbi quis commodo odio:</p>

                <ol>
                    <li>Semper auctor neque vitae tempus quam pellentesque nec nam.</li>
                    <li>Odio aenean sed adipiscing diam <strong>generate</strong> tristique.</li>
                </ol>

                <p>Amet luctus venenatis lectus:</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="nc">IServiceProvider</span> <span class="p">-&gt;</span> <span class="k">'</span><span class="nc">TService</span>
</code></pre>
                    </div>
                </div>

                <p>Dignissim cras tincidunt lobortis feugiat <code class="highlighter-rouge">string -&gt; OrderNumber</code>.</p>

                <p>Eros in cursus turpis massa tincidunt dui ut. Amet massa vitae tortor condimentum lacinia quis vel. Ornare quam viverra orci sagittis:</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="nc">IServiceProvider</span> <span class="p">-&gt;</span> <span class="p">(</span><span class="nc">Product</span> <span class="p">-&gt;</span> <span class="nc">OrderNumber</span><span class="p">)</span>
</code></pre>
                    </div>
                </div>

                <p>Ut diam quam nulla porttitor massa. Aliquet nec ullamcorper sit amet risus nullam eget:</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="k">let</span> <span class="n">factory</span> <span class="p">(</span><span class="n">services</span><span class="p">:</span> <span class="nc">IServiceProvider</span><span class="o">):</span> <span class="p">(</span><span class="nc">Product</span> <span class="p">-&gt;</span> <span class="nc">OrderNumber</span><span class="p">)</span> <span class="p">=</span>
    <span class="c1">// Resolve dependencies from DI container</span>
    <span class="k">let</span> <span class="n">configuration</span> <span class="p">=</span> <span class="n">services</span><span class="p">.</span><span class="nc">GetService</span><span class="p">&lt;</span><span class="nc">IConfiguration</span><span class="o">&gt;().</span><span class="nc">GetSection</span><span class="p">(</span><span class="s2">"Orders"</span><span class="p">)</span>

    <span class="c1">// Create the number counter (a state or order generator)</span>
    <span class="k">let</span> <span class="n">startNumber</span> <span class="p">=</span> <span class="n">configuration</span><span class="p">.</span><span class="nc">GetValue</span><span class="p">&lt;</span><span class="kt">int</span><span class="o">&gt;(</span><span class="s2">"StartOrderNumber"</span><span class="p">)</span>
    <span class="k">let</span> <span class="n">counter</span> <span class="p">=</span> <span class="nc">Counter</span> <span class="p">(</span><span class="n">startNumber</span><span class="p">)</span>

    <span class="c1">// Partially apply dependencies into the function (counter state in our case)        </span>
    <span class="n">generate</span> <span class="n">counter</span>
</code></pre>
                    </div>
                </div>

                <p>Commodo nulla facilisi nullam vehicula ipsum a arcu.</p>

                <p>Pretium viverra suspendisse potenti nullam ac. Risus pretium quam vulputate dignissim suspendisse in est ante in. Pellentesque pulvinar pellentesque habitant morbi tristique senectus et netus et. Vitae auctor eu augue ut lectus arcu bibendum at.</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="k">let</span> <span class="n">configureServices</span> <span class="p">(</span><span class="n">services</span> <span class="p">:</span> <span class="nc">IServiceCollection</span><span class="p">)</span> <span class="p">=</span>
    <span class="c1">// Registration of services to DI container</span>
    <span class="n">services</span><span class="p">.</span><span class="nc">AddSingleton</span><span class="p">&lt;</span><span class="nc">Product</span> <span class="p">-&gt;</span> <span class="nc">OrderNumber</span><span class="o">&gt;(</span><span class="nn">OrderNumbering</span><span class="p">.</span><span class="n">factory</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
    <span class="n">services</span><span class="p">.</span><span class="nc">AddGiraffe</span><span class="bp">()</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
</code></pre>
                    </div>
                </div>

                <p>Aliquet porttitor lacus luctus accumsan tortor posuere ac. Nulla aliquet porttitor lacus luctus. Ipsum dolor sit amet consectetur.</p>

                <p>Risus sed vulputate odio ut enim blandit volutpat maecenas. Dolor magna eget est lorem ipsum dolor sit. Aliquam ut porttitor leo a diam sollicitudin tempor id. Cursus in hac habitasse platea dictumst quisque sagittis purus.</p>

                <p>Neque gravida in fermentum et. Sapien pellentesque habitant morbi tristique senectus et netus et malesuada.</p>

                <h2 id="passing-f-functions-as-c-delegates">Passing F# functions as C# delegates</h2>

                <p>Sit amet nisl purus in mollis aenean pharetra magna ac placerat vestibulum lectus mauris ultrices.</p>

                <p>Volutpat lacus laoreet non curabitur gravida arcu ac tortor. Tellus orci ac auctor augue mauris augue neque. Ultrices eros in cursus turpis massa tincidunt dui ut. Mattis molestie a iaculis at erat pellentesque. Faucibus turpis in eu mi bibendum.</p>

                <p>Platea dictumst vestibulum rhoncus est pellentesque elit ullamcorper dignissim.</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="k">open</span> <span class="nc">System</span>
<span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Runtime</span><span class="p">.</span><span class="nc">CompilerServices</span>
<span class="k">open</span> <span class="nn">Microsoft</span><span class="p">.</span><span class="nn">Extensions</span><span class="p">.</span><span class="nc">DependencyInjection</span>

<span class="p">[&lt;</span><span class="nc">Extension</span><span class="p">&gt;]</span>
<span class="k">type</span> <span class="nc">ServiceCollectionFunctionExtensions</span><span class="bp">()</span> <span class="p">=</span>
    
    <span class="p">[&lt;</span><span class="nc">Extension</span><span class="p">&gt;]</span>
    <span class="k">static</span> <span class="k">member</span> <span class="k">inline</span> <span class="nc">AddSingleton</span><span class="p">&lt;</span><span class="k">'</span><span class="nc">TService</span> <span class="k">when</span> <span class="k">'</span><span class="nc">TService</span><span class="p">:</span> <span class="k">not</span> <span class="k">struct</span><span class="p">&gt;</span>
        <span class="p">(</span>
            <span class="n">services</span><span class="p">:</span> <span class="nc">IServiceCollection</span><span class="p">,</span>
            <span class="n">implementationFactory</span><span class="p">:</span> <span class="nc">IServiceProvider</span> <span class="p">-&gt;</span> <span class="k">'</span><span class="nc">TService</span>
        <span class="o">):</span> <span class="nc">IServiceCollection</span> <span class="p">=</span>
            <span class="n">services</span><span class="p">.</span><span class="nc">AddSingleton</span><span class="p">&lt;</span><span class="k">'</span><span class="nc">TService</span><span class="o">&gt;(</span><span class="nc">Func</span><span class="p">&lt;</span><span class="nc">IServiceProvider</span><span class="p">,</span> <span class="k">'</span><span class="nc">TService</span><span class="p">&gt;</span> <span class="n">implementationFactory</span><span class="p">)</span>
</code></pre>
                    </div>
                </div>

                <p>Vitae semper quis lectus <a href="https://github.com/fsharp/fslang-design/blob/master/RFCs/FS-1035-consistent-delegate-type-directed-conversion.md">RFC FS-1035</a> nulla at volutpat diam ut venenatis. Ullamcorper morbi tincidunt ornare massa eget egestas purus viverra accumsan. Pretium quam vulputate dignissim suspendisse. Risus quis varius quam quisque id diam vel quam.</p>

                <h1 id="resolving-the-functions">Resolving the functions</h1>

                <p>Cras sed felis eget velit aliquet sagittis id consectetur:</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="k">let</span> <span class="n">handleOrder</span> <span class="p">(</span><span class="n">order</span><span class="p">:</span> <span class="nc">OrderRequest</span><span class="p">)</span> <span class="p">:</span> <span class="nc">HttpHandler</span> <span class="p">=</span>
    <span class="k">fun</span> <span class="p">(</span><span class="n">next</span> <span class="p">:</span> <span class="nc">HttpFunc</span><span class="p">)</span> <span class="p">(</span><span class="n">ctx</span> <span class="p">:</span> <span class="nc">HttpContext</span><span class="p">)</span> <span class="p">-&gt;</span>
        <span class="n">task</span> <span class="p">{</span>
            <span class="c1">// Use function signature to resolve the order number generator from DI container (FIX)`</span>
            <span class="k">let</span> <span class="n">generateOrderNumber</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="nc">GetService</span><span class="p">&lt;</span><span class="nc">Product</span> <span class="p">-&gt;</span> <span class="nc">OrderNumber</span><span class="o">&gt;()</span>
            
            <span class="c1">// Generate order number using the resolved generator function</span>
            <span class="k">let</span> <span class="n">orderNumber</span> <span class="p">=</span> <span class="n">generateOrderNumber</span> <span class="n">product</span>

            <span class="c1">// Send back order confirmation with order number</span>
            <span class="k">let</span> <span class="n">orderConfirmation</span> <span class="p">=</span> <span class="p">{</span> <span class="nc">OrderNumber</span> <span class="p">=</span> <span class="n">orderNumber</span><span class="p">.</span><span class="nc">ToString</span> <span class="bp">()</span> <span class="p">}</span>
            <span class="k">return</span><span class="o">!</span> <span class="n">json</span> <span class="n">orderConfirmation</span> <span class="n">next</span> <span class="n">ctx</span>
        <span class="p">}</span>
</code></pre>
                    </div>
                </div>

                <p>Condimentum mattis pellentesque id nibh tortor id aliquet. Donec ultrices tincidunt arcu non sodales neque sodales.</p>

                <p>Mattis molestie a iaculis at erat pellentesque adipiscing commodo elit. Ac turpis egestas maecenas pharetra convallis. Scelerisque fermentum dui faucibus in ornare quam viverra.</p>

                <p>Quam lacus suspendisse faucibus interdum. Ut enim blandit volutpat maecenas volutpat blandit aliquam etiam. Suspendisse faucibus interdum posuere lorem ipsum dolor sit amet. Malesuada fames ac turpis egestas maecenas pharetra convallis posuere morbi. Eget nunc lobortis mattis aliquam faucibus purus in massa.</p>

                <h1 id="disposing-resources">Disposing resources</h1>

                <p>Vel elit scelerisque mauris pellentesque pulvinar pellentesque habitant.</p>

                <p>In est ante in nibh mauris cursus mattis molestie. Interdum consectetur libero id faucibus nisl tincidunt eget nullam.</p>

                <p>Nisi lacus sed viverra tellus in hac habitasse. Mattis nunc sed blandit libero volutpat sed cras ornare:</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="k">module</span> <span class="nc">OrderPlacement</span> <span class="p">=</span>

    <span class="k">let</span> <span class="k">private</span> <span class="n">saveOrder</span> <span class="n">file</span> <span class="n">orderNumber</span> <span class="n">product</span> <span class="n">quantity</span> <span class="p">=</span>
        <span class="k">let</span> <span class="p">(</span><span class="nc">ProductId</span> <span class="n">productId</span><span class="p">)</span> <span class="p">=</span> <span class="n">product</span>
        <span class="k">let</span> <span class="p">(</span><span class="nc">Pcs</span> <span class="n">quantityPcs</span><span class="p">)</span> <span class="p">=</span> <span class="n">quantity</span>
        <span class="n">fprintfn</span> <span class="n">file</span> <span class="s2">"Order# %s, Product: %d, Quantity (pcs): %d"</span> <span class="p">(</span><span class="n">orderNumber</span><span class="p">.</span><span class="nc">ToString</span> <span class="bp">()</span><span class="p">)</span> <span class="n">productId</span> <span class="n">quantityPcs</span>

    <span class="k">let</span> <span class="k">private</span> <span class="n">placeOrder</span> <span class="n">generateOrderNumber</span> <span class="n">orderFile</span> <span class="p">(</span><span class="n">product</span><span class="p">:</span> <span class="nc">Product</span><span class="p">)</span> <span class="p">(</span><span class="n">quantity</span><span class="p">:</span> <span class="nc">Quantity</span><span class="p">)</span> <span class="p">:</span> <span class="nc">OrderConfirmation</span> <span class="p">=</span>
        <span class="c1">// Generate order number using the resolved generator function</span>
        <span class="k">let</span> <span class="n">orderNumber</span> <span class="p">=</span> <span class="n">generateOrderNumber</span> <span class="n">product</span>

        <span class="c1">// TODO: Comment</span>
        <span class="n">saveOrder</span> <span class="n">orderFile</span> <span class="n">orderNumber</span> <span class="n">product</span> <span class="n">quantity</span>
    
        <span class="c1">// Order confirmation</span>
        <span class="p">{</span> <span class="nc">OrderNumber</span> <span class="p">=</span> <span class="n">orderNumber</span><span class="p">.</span><span class="nc">ToString</span> <span class="bp">()</span> <span class="p">}</span>
</code></pre>
                    </div>
                </div>

                <h2 id="disposable-function">Disposable function</h2>

                <p>Massa ultricies mi quis hendrerit dolor. Pellentesque elit eget gravida cum sociis natoque penatibus et.</p>

                <p>Curabitur vitae nunc sed velit dignissim sodales ut. Auctor eu augue ut lectus arcu. Tincidunt dui ut ornare lectus sit amet est <code class="highlighter-rouge">FSharpFunc&lt;T, TRes&gt;</code> placerat.</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="p">[&lt;</span><span class="nc">AbstractClass</span><span class="p">&gt;]</span>
<span class="k">type</span> <span class="nc">FSharpFunc</span><span class="p">&lt;</span><span class="k">'</span><span class="nc">T</span><span class="p">,</span><span class="k">'</span><span class="nc">Res</span><span class="p">&gt;</span> <span class="p">[&lt;</span><span class="nc">DebuggerHidden</span><span class="p">&gt;]</span> <span class="bp">()</span> <span class="p">=</span> 
    <span class="k">abstract</span> <span class="nc">Invoke</span> <span class="p">:</span> <span class="k">'</span><span class="nc">T</span> <span class="p">-&gt;</span> <span class="k">'</span><span class="nc">Res</span>
</code></pre>
                    </div>
                </div>

                <p>Ornare massa eget egestas purus viverra accumsan in nisl nisi. Augue interdum velit euismod in. Nec tincidunt praesent semper <code class="highlighter-rouge">IDisposable</code> nibh sed pulvinar.</p>

                <p>A lacus vestibulum sed arcu non odio euismod lacinia at. Proin fermentum leo vel orci. Dictumst quisque sagittis purus sit amet volutpat consequat mauris nunc.</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="k">module</span> <span class="nc">ServiceCollectionUtils</span> <span class="p">=</span>

    <span class="k">type</span> <span class="k">private</span> <span class="nc">DisposableFunc</span><span class="p">&lt;</span><span class="k">'</span><span class="nc">T</span><span class="p">,</span> <span class="k">'</span><span class="nc">TRes</span><span class="p">&gt;</span> <span class="p">(</span><span class="n">invokeFunc</span><span class="p">:</span> <span class="k">'</span><span class="nc">T</span> <span class="p">-&gt;</span> <span class="k">'</span><span class="nc">TRes</span><span class="p">,</span> <span class="n">disposeFunc</span><span class="p">:</span> <span class="kt">unit</span> <span class="p">-&gt;</span> <span class="kt">unit</span><span class="p">)</span> <span class="p">=</span>
        <span class="k">inherit</span> <span class="nc">FSharpFunc</span><span class="p">&lt;</span><span class="k">'</span><span class="nc">T</span><span class="p">,</span> <span class="k">'</span><span class="nc">TRes</span><span class="o">&gt;()</span>

        <span class="k">override</span> <span class="n">this</span><span class="p">.</span><span class="nc">Invoke</span> <span class="n">arg</span> <span class="p">=</span> <span class="n">invokeFunc</span> <span class="n">arg</span>

        <span class="k">interface</span> <span class="nc">IDisposable</span> <span class="k">with</span>
            <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nc">Dispose</span><span class="bp">()</span> <span class="p">=</span> <span class="n">disposeFunc</span> <span class="bp">()</span>
</code></pre>
                    </div>
                </div>

                <p>Convallis aenean et tortor at risus viverra. Fames ac turpis egestas maecenas pharetra. Tempor orci eu lobortis elementum nibh. Neque vitae tempus quam pellentesque nec nam aliquam sem. Ac orci phasellus egestas tellus rutrum tellus.</p>

                <h2 id="helper-function">Helper function</h2>

                <p>Enim eu turpis egestas pretium aenean pharetra magna ac placerat.</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="c1">// TODO: Better naming of parameters</span>
<span class="k">let</span> <span class="n">withDispose</span> <span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="k">'</span><span class="n">a</span> <span class="p">-&gt;</span> <span class="k">'</span><span class="n">b</span><span class="p">)</span> <span class="p">(</span><span class="n">dispose</span><span class="p">:</span> <span class="kt">unit</span> <span class="p">-&gt;</span> <span class="kt">unit</span><span class="o">):</span> <span class="k">'</span><span class="n">a</span> <span class="p">-&gt;</span> <span class="k">'</span><span class="n">b</span> <span class="p">=</span>
    <span class="k">new</span> <span class="nc">DisposableFunc</span><span class="p">&lt;</span><span class="k">'</span><span class="n">a</span><span class="p">,</span> <span class="k">'</span><span class="n">b</span><span class="p">&gt;</span> <span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">dispose</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="n">box</span> <span class="p">|&gt;</span> <span class="n">unbox</span><span class="p">&lt;</span><span class="k">'</span><span class="n">a</span> <span class="p">-&gt;</span> <span class="k">'</span><span class="n">b</span><span class="p">&gt;</span>
</code></pre>
                    </div>
                </div>

                <p>Nec feugiat nisl pretium fusce id velit ut tortor pretium. Euismod elementum nisi quis eleifend quam.</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="k">let</span> <span class="n">factory</span> <span class="p">(</span><span class="n">services</span><span class="p">:</span> <span class="nc">IServiceProvider</span><span class="o">):</span> <span class="p">(</span><span class="nc">Product</span> <span class="p">-&gt;</span> <span class="nc">Quantity</span><span class="p">-&gt;</span> <span class="nc">OrderConfirmation</span><span class="p">)</span> <span class="p">=</span>
    <span class="k">let</span> <span class="n">generateOrderNumber</span> <span class="p">=</span> <span class="n">services</span><span class="p">.</span><span class="nc">GetService</span><span class="p">&lt;</span><span class="nc">Product</span> <span class="p">-&gt;</span> <span class="nc">OrderNumber</span><span class="o">&gt;()</span>

    <span class="c1">// File for saving placed orders</span>
    <span class="k">let</span> <span class="n">orderFile</span> <span class="p">=</span> <span class="k">new</span> <span class="nc">StreamWriter</span><span class="p">(</span><span class="s2">"./orders.txt"</span><span class="p">,</span> <span class="bp">true</span><span class="p">,</span> <span class="k">new</span> <span class="nc">UTF8Encoding</span><span class="p">(</span><span class="bp">false</span><span class="o">))</span> <span class="p">:&gt;</span> <span class="nc">TextWriter</span>

    <span class="c1">// Partially apply the function with dependency parameters</span>
    <span class="n">placeOrder</span> <span class="n">generateOrderNumber</span> <span class="n">orderFile</span> <span class="p">|&gt;</span> <span class="n">withDispose</span> <span class="n">orderFile</span><span class="p">.</span><span class="nc">Close</span>
</code></pre>
                    </div>
                </div>

                <p>Tellus orci ac auctor augue mauris. Id aliquet lectus proin nibh nisl condimentum. Enim ut tellus elementum sagittis vitae et leo duis ut. Urna duis convallis convallis tellus id interdum velit.</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="k">let</span> <span class="n">configureServices</span> <span class="p">(</span><span class="n">services</span> <span class="p">:</span> <span class="nc">IServiceCollection</span><span class="p">)</span> <span class="p">=</span>
    <span class="c1">// Registration of services to DI container</span>
    <span class="n">services</span><span class="p">.</span><span class="nc">AddSingleton</span><span class="p">&lt;</span><span class="nc">Product</span> <span class="p">-&gt;</span> <span class="nc">OrderNumber</span><span class="o">&gt;(</span><span class="nn">OrderNumbering</span><span class="p">.</span><span class="n">factory</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
    <span class="n">services</span><span class="p">.</span><span class="nc">AddSingleton</span><span class="p">&lt;</span><span class="nc">Product</span> <span class="p">-&gt;</span> <span class="nc">Quantity</span> <span class="p">-&gt;</span> <span class="nc">OrderConfirmation</span><span class="o">&gt;(</span><span class="nn">OrderPlacement</span><span class="p">.</span><span class="n">factory</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
    <span class="n">services</span><span class="p">.</span><span class="nc">AddGiraffe</span><span class="bp">()</span> <span class="p">|&gt;</span> <span class="n">ignore</span>
</code></pre>
                    </div>
                </div>

                <p>Cras sed felis eget velit aliquet sagittis id consectetur. Lacus sed turpis tincidunt id aliquet risus. Nulla facilisi morbi tempus iaculis urna:</p>

                <div class="language-fsharp highlighter-rouge">
                    <div class="highlight">
                        <pre class="highlight"><code><span class="c1">// Our application logic here: handling customer orders</span>
<span class="k">let</span> <span class="n">handleOrder</span> <span class="p">(</span><span class="n">order</span><span class="p">:</span> <span class="nc">OrderRequest</span><span class="p">)</span> <span class="p">:</span> <span class="nc">HttpHandler</span> <span class="p">=</span>
    <span class="k">fun</span> <span class="p">(</span><span class="n">next</span> <span class="p">:</span> <span class="nc">HttpFunc</span><span class="p">)</span> <span class="p">(</span><span class="n">ctx</span> <span class="p">:</span> <span class="nc">HttpContext</span><span class="p">)</span> <span class="p">-&gt;</span>
        <span class="n">task</span> <span class="p">{</span>
            <span class="c1">// TODO: Comment</span>
            <span class="k">let</span> <span class="n">placeOrder</span> <span class="p">=</span> <span class="n">ctx</span><span class="p">.</span><span class="nc">GetService</span><span class="p">&lt;</span><span class="nc">Product</span> <span class="p">-&gt;</span> <span class="nc">Quantity</span> <span class="p">-&gt;</span> <span class="nc">OrderConfirmation</span><span class="o">&gt;()</span>

            <span class="c1">// TODO: Comment</span>
            <span class="k">let</span> <span class="n">product</span> <span class="p">=</span> <span class="nc">ProductId</span> <span class="n">order</span><span class="p">.</span><span class="nc">ProductId</span>
            <span class="k">let</span> <span class="n">quantity</span> <span class="p">=</span> <span class="nc">Pcs</span> <span class="n">order</span><span class="p">.</span><span class="nc">Quantity</span>
            
            <span class="c1">// TODO: Comment</span>
            <span class="k">let</span> <span class="n">orderConfirmation</span> <span class="p">=</span> <span class="n">placeOrder</span> <span class="n">product</span> <span class="n">quantity</span>
                        
            <span class="c1">// Send back order confirmation with order number</span>
            <span class="k">return</span><span class="o">!</span> <span class="n">json</span> <span class="n">orderConfirmation</span> <span class="n">next</span> <span class="n">ctx</span>
        <span class="p">}</span>
</code></pre>
                    </div>
                </div>

                <p>Aliquam ultrices sagittis orci a scelerisque purus semper eget duis. Nulla facilisi morbi tempus iaculis urna id volutpat lacus.</p>

                <p>Adipiscing diam donec adipiscing tristique. Tincidunt praesent semper feugiat nibh sed. Lorem mollis aliquam ut porttitor.</p>

                <p>In hac habitasse platea dictumst. Venenatis tellus in metus vulputate eu scelerisque felis imperdiet.</p>

                <h1 id="conclusion">Conclusion</h1>

                <p>Tempus egestas sed sed risus pretium quam vulputate dignissim. Pulvinar etiam non quam lacus suspendisse.</p>

                <p>At consectetur lorem donec massa sapien faucibus et molestie. Ultrices sagittis orci a scelerisque purus. Elementum pulvinar etiam non quam. Cursus in hac habitasse platea dictumst quisque sagittis.</p>

                <h1 id="more-information">More information</h1>

                <p>Massa ultricies mi quis hendrerit dolor magna. Est ullamcorper eget nulla facilisi etiam:</p>

                <ul>
                    <li><a href="https://kostr.se/c9db5">Et molestie ac feugiat sed lectus.</a></li>
                    <li><a href="https://kostr.se/e8042">Felis eget nunc lobortis mattis aliquam faucibus purus in.</a></li>
                    <li><a href="https://kostr.se/c9db5">Praesent semper feugiat nibh sed pulvinar proin gravida.</a></li>
                    <li><a href="https://kostr.se/e8042">Laoreet suspendisse interdum consectetur libero id faucibus nisl tincidunt eget.</a></li>
                </ul>



                <hr>

                <div class="clearfix">


                    <a class="btn btn-primary float-left" href="/2017/man-must-explore" data-toggle="tooltip" data-placement="top" title="" data-original-title="Man must explore, and this is exploration at its greatest">← Previous<span class="d-none d-md-inline"> Post</span></a>



                </div>

            </div>
        </div>
    </div>


    <!-- Footer -->

    <hr>

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-md-10 mx-auto">
                    <ul class="list-inline text-center">

                        <li class="list-inline-item">
                            <a href="https://www.twitter.com/kostrse">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
                        </li>



                        <li class="list-inline-item">
                            <a href="https://github.com/kostrse">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
                        </li>

                    </ul>
                    <p class="copyright text-muted">Copyright &copy; Sergey Kostrukov 2019</p>
                </div>
            </div>
        </div>
    </footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>

    <script src="/assets/js/scripts.js"></script>

</body>

</html>
